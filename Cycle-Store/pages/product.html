<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Product Details - Cycle Store</title>
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div id="app">
        <div id="header-container"></div>
        
        <main class="main-content product-details-page">
            <div class="container">
                <nav class="breadcrumb">
                    <a href="../index.html">Home</a> &gt;
                    <a href="../index.html#products">Bicycles</a> &gt;
                    <span id="product-category">Mountain Bike</span>
                </nav>
                
                <div class="product-details-container">
                    <div class="product-gallery">
                        <div class="main-image">
                            <img id="product-main-image" src="../assets/images/bike1.jpg" alt="Bicycle">
                        </div>
                    </div>
                    
                    <div class="product-info">
                        <h1 id="product-name">Velocity X1 Mountain Bike</h1>
                        <div class="product-meta">
                            <span class="product-category" id="product-category-text">Mountain Bike</span>
                            <span class="product-rating">
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star"></i>
                                <i class="fas fa-star-half-alt"></i>
                                <span>4.5 (42 reviews)</span>
                            </span>
                        </div>
                        
                        <div class="product-price">
                            <span id="product-price">$899.99</span>
                        </div>
                        
                        <div class="product-description">
                            <h3>Description</h3>
                            <p id="product-description-text">A premium mountain bike designed for trail riding with advanced suspension and durable components.</p>
                            
                            <div class="product-features">
                                <h4>Key Features</h4>
                                <ul id="product-features-list">
                                    <!-- Features will be populated by JS -->
                                </ul>
                            </div>
                        </div>
                        
                        <div class="product-actions">
                            <button id="buy-now-btn" class="btn btn-primary btn-large">
                                <i class="fas fa-shopping-bag"></i> Buy Now
                            </button>
                            
                            <div class="product-warranty">
                                <i class="fas fa-shield-alt"></i>
                                <span>2-year warranty & free assembly included</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="related-products">
                    <h2>You Might Also Like</h2>
                    <div class="related-products-grid" id="related-products">
                        <!-- Related products loaded by JS -->
                    </div>
                </div>
            </div>
        </main>
        
        <div id="footer-container"></div>
    </div>

    <script src="../assets/js/auth.js"></script>
    <script src="../assets/js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            loadHeader();
            loadFooter();
            
            // Get product ID from URL
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id');
            
            // Get all products
            const products = getProducts();
            
            // Find the requested product
            let product = products[0]; // Default to first product
            if (productId) {
                const foundProduct = products.find(p => p.id === parseInt(productId));
                if (foundProduct) {
                    product = foundProduct;
                }
            }
            
            // Update page with product data
            updateProductDetails(product);
            
            // Load related products (excluding current product)
            loadRelatedProducts(product);
            
            // Setup buy now button
            const buyNowBtn = document.getElementById('buy-now-btn');
            buyNowBtn.addEventListener('click', function() {
                // Check if user is logged in
                if (!isLoggedIn()) {
                    alert('Please login or register to proceed to checkout.');
                    window.location.href = '../login.html';
                    return;
                }
                
                // Store product in localStorage for checkout
                localStorage.setItem('checkoutProduct', JSON.stringify(product));
                
                // Redirect to checkout page
                window.location.href = `../checkout.html?product=${product.id}`;
            });
        });
        
        function updateProductDetails(product) {
            // Update page elements with product data
            document.getElementById('product-name').textContent = product.name;
            document.getElementById('product-category').textContent = product.category;
            document.getElementById('product-category-text').textContent = product.category;
            document.getElementById('product-price').textContent = `$${product.price.toFixed(2)}`;
            document.getElementById('product-main-image').src = product.image;
            document.getElementById('product-main-image').alt = product.name;
            
            // Generate description
            document.getElementById('product-description-text').textContent = 
                product.description || `The ${product.name} is a premium ${product.category.toLowerCase()} designed for ${product.useCase}.`;
            
            // Generate features
            const featuresList = document.getElementById('product-features-list');
            featuresList.innerHTML = '';
            
            const features = [
                `${product.frameMaterial} frame for durability and lightweight performance`,
                `${product.wheelSize}" wheels for optimal ${product.terrain} terrain`,
                `${product.gears}-speed gear system for versatile riding`,
                `${product.brakeType} brakes for reliable stopping power`,
                `Ergonomic design for comfort during long rides`
            ];
            
            features.forEach(feature => {
                const li = document.createElement('li');
                li.innerHTML = `<i class="fas fa-check"></i> ${feature}`;
                featuresList.appendChild(li);
            });
        }
        
        function loadRelatedProducts(currentProduct) {
            const products = getProducts();
            const relatedProducts = products.filter(p => 
                p.id !== currentProduct.id && p.category === currentProduct.category
            ).slice(0, 3);
            
            const container = document.getElementById('related-products');
            
            if (relatedProducts.length === 0) {
                container.innerHTML = '<p class="no-related">No related products found.</p>';
                return;
            }
            
            container.innerHTML = relatedProducts.map(product => `
                <div class="product-card">
                    <div class="product-image">
                        <img src="${product.image}" alt="${product.name}">
                    </div>
                    <div class="product-info">
                        <h3>${product.name}</h3>
                        <p class="product-category">${product.category}</p>
                        <p class="product-price">$${product.price.toFixed(2)}</p>
                        <a href="../pages/product.html?id=${product.id}" class="btn btn-secondary">View Details</a>
                    </div>
                </div>
            `).join('');
        }
    </script>
</body>
</html>